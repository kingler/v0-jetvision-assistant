# UAT Instructions: ONEK-199

**Issue**: [ONEK-199] Sidebar status stuck on "Pending" after proposals sent
**Date Generated**: 2026-02-08
**Branch**: `kinglerbercy/onek-199-bug-sidebar-status-stuck-on-pending-after-proposals-sent` (related commit `f889a42`)
**Status**: Done
**Priority**: High
**Author**: Generated by Claude Code `/uat_instructions`

---

## Overview

This bug fix addresses the chat sidebar incorrectly displaying a "Pending" badge and "Analyzing Options" text for sessions where proposals have already been sent to the client. The root cause was that the `ChatSession` status was not being updated after the `proposal_sent` tool call, either because the workflow status in the database was stale or the status update was not propagating from the chat API route to the sidebar component. After the fix, the sidebar now correctly reflects the current workflow state of each session.

---

## Acceptance Criteria

### AC-1: Sidebar Status Updates to "Proposal Sent" After Proposal Delivery

**Given** a chat session where the agent has successfully sent one or more proposals to the client via the `proposal_sent` tool
**When** the user views the session entry in the chat sidebar
**Then** the status badge displays "Proposal Sent" (not "Pending") and the status text reflects the correct workflow state

### AC-2: Status Transitions Through All Workflow States Correctly

**Given** a chat session progressing through the full workflow (request created -> searching flights -> quotes received -> analyzing -> proposal sent)
**When** each workflow transition occurs
**Then** the sidebar badge and status text update to reflect the current state at each transition without requiring a page refresh

### AC-3: Page Refresh Preserves Correct Status

**Given** a chat session with status "Proposal Sent" displayed in the sidebar
**When** the user refreshes the browser page (F5 or Cmd+R)
**Then** the sidebar reloads and continues to display "Proposal Sent" (the status was persisted to the database, not just held in client state)

### AC-4: Multiple Sessions Display Independent Statuses

**Given** multiple chat sessions in the sidebar, each at different workflow stages (one "Pending", one "Quotes Received", one "Proposal Sent")
**When** the user views the sidebar session list
**Then** each session displays its own correct status independently, with no cross-contamination between session statuses

---

## Test Steps

### Test 1: Proposal Sent Status Display (Maps to AC-1)

1. Open the application at `http://localhost:3001`
2. Navigate to the CJTQML chat session (where 2 proposals have been sent)
3. Look at the sidebar entry for this session
4. Inspect the status badge
   - **Expected**: Badge shows "Proposal Sent" (green or appropriate color), NOT "Pending"
5. Inspect the status text below the route
   - **Expected**: Text shows a proposal-related status, NOT "Analyzing Options"
6. Click into the session and verify proposals are visible in the chat thread
   - **Expected**: Proposal cards are present in the chat, confirming proposals were indeed sent

**Result**: [ ] Pass  [ ] Fail

**Notes**: _______________

---

### Test 2: Workflow State Transitions (Maps to AC-2)

1. Open the application at `http://localhost:3001`
2. Create a new chat session with a flight request: "I need a flight from KTEB to KLAX on March 20"
3. Watch the sidebar status as the agent processes the request
   - **Expected**: Status transitions from "New" or initial state to "Searching" while the trip is being created
4. After the trip is created and quotes are received, check the sidebar
   - **Expected**: Status updates to "Quotes Received" or equivalent
5. If possible, trigger a proposal send from the chat interface
   - **Expected**: Sidebar status updates to "Proposal Sent" without needing a page refresh

**Result**: [ ] Pass  [ ] Fail

**Notes**: _______________

---

### Test 3: Persistence After Page Refresh (Maps to AC-3)

1. Identify a chat session showing "Proposal Sent" in the sidebar (use CJTQML if available)
2. Note the current status displayed
3. Refresh the browser page (Cmd+R or F5)
4. Wait for the app to fully reload
5. Check the sidebar status for the same session
   - **Expected**: Status still shows "Proposal Sent" after refresh
6. Open browser DevTools Network tab and inspect the `/api/chat-sessions` response
   - **Expected**: The session data from the API includes the correct status value

**Result**: [ ] Pass  [ ] Fail

**Notes**: _______________

---

### Test 4: Independent Session Statuses (Maps to AC-4)

1. Open the application at `http://localhost:3001`
2. Ensure at least 2-3 chat sessions exist in the sidebar at different stages
3. Review each session's status badge in the sidebar
   - **Expected**: Each session shows its own independent status (e.g., one may show "Pending", another "Proposal Sent")
4. Click into each session to verify the status matches the actual chat content
   - **Expected**: The status badge matches what has actually happened in each chat thread
5. No session should show another session's status

**Result**: [ ] Pass  [ ] Fail

**Notes**: _______________

---

## Test Data & Environment

### Environment Requirements

- **URL**: `http://localhost:3001` (development) or staging URL
- **Branch**: `main` (merged)
- **Setup**: `npm install && npm run dev`

### Test Data

- **Existing session with proposals**: CJTQML (KTEB to KVNY, 2 proposals sent)
- **New session**: Create with "I need a flight from KTEB to KLAX on March 20"
- **Verify via database**: Check `requests` or `chat_sessions` table in Supabase for `status` field values

### Pre-Test Setup

1. Ensure all dependencies are installed: `npm install`
2. Start the development server: `npm run dev`
3. Verify the CJTQML session exists and proposals were previously sent

---

## Sign-Off

| Tester | Role | Result | Date | Signature |
|--------|------|--------|------|-----------|
| @AB | QA Lead | [ ] Pass [ ] Fail | ____-__-__ | _________ |
| @Kham | Developer | [ ] Pass [ ] Fail | ____-__-__ | _________ |

### Final Disposition

- [ ] All tests passed -- ready for production
- [ ] Issues found -- see notes above
- [ ] Blocked -- requires {description}

---

*Generated by `/uat_instructions ONEK-199` on 2026-02-08*
