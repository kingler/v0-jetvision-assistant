# UAT Instructions: ONEK-200

**Issue**: [ONEK-200] Sidebar and header show one-way arrow instead of round-trip for round-trip sessions
**Date Generated**: 2026-02-08
**Branch**: `kinglerbercy/onek-200-bug-sidebar-and-header-show-instead-of-for-round-trip` (related commit `f889a42`)
**Status**: Done
**Priority**: Medium
**Author**: Generated by Claude Code `/uat_instructions`

---

## Overview

This bug fix addresses the chat sidebar and dynamic chat header displaying a one-way arrow (KTEB -> KVNY) for round-trip flight sessions instead of a two-way arrow (KTEB <-> KVNY). The root cause was that the `ChatSession` interface lacked `tripType` and `returnDate` fields, and the route string was stored without trip type context. The fix adds `tripType` and `returnDate` to the `ChatSession` interface, updates the `/api/chat-sessions` endpoint to include `trip_type` from the requests table, and conditionally renders the round-trip indicator and return date in the sidebar and header.

---

## Acceptance Criteria

### AC-1: Sidebar Displays Round-Trip Arrow for Round-Trip Sessions

**Given** a chat session associated with a round-trip flight request (e.g., KTEB to KVNY with return)
**When** the user views the session list in the chat sidebar
**Then** the route display shows a two-way arrow (e.g., "KTEB <-> KVNY") and the return date is visible alongside the outbound date

### AC-2: Header Subtitle Shows Round-Trip Indicator

**Given** a round-trip chat session is selected and active
**When** the dynamic chat header renders the session subtitle
**Then** the header displays the two-way arrow (KTEB <-> KVNY) with both outbound and return dates, matching the sidebar display

### AC-3: One-Way Sessions Retain Single Arrow (Regression)

**Given** a chat session associated with a one-way flight request
**When** the user views the session in the sidebar or header
**Then** the route display shows a single-direction arrow (e.g., "KTEB -> KLAX") with only the outbound date, and no return date is displayed

### AC-4: Sessions Without Trip Type Default to One-Way Display

**Given** a legacy chat session created before this fix (where `tripType` may be null or undefined in the database)
**When** the sidebar and header render this session
**Then** the route defaults to one-way arrow display with no crashes or "undefined" text, maintaining backward compatibility

---

## Test Steps

### Test 1: Sidebar Round-Trip Arrow (Maps to AC-1)

1. Open the application at `http://localhost:3001`
2. Locate the CJTQML chat session in the sidebar (round-trip: KTEB to KVNY)
3. Inspect the route text in the sidebar entry
   - **Expected**: Route shows "KTEB <-> KVNY" (two-way indicator), NOT "KTEB -> KVNY"
4. Inspect the date display in the sidebar entry
   - **Expected**: Both outbound date (Mar 2) and return date (Mar 5) are shown
5. Verify the two-way arrow is visually distinct from a one-way arrow

**Result**: [ ] Pass  [ ] Fail

**Notes**: _______________

---

### Test 2: Header Subtitle Round-Trip Display (Maps to AC-2)

1. Click on the CJTQML chat session to make it active
2. Look at the dynamic chat header at the top of the chat area
3. Inspect the subtitle/route text in the header
   - **Expected**: Header subtitle shows the two-way arrow indicator (KTEB <-> KVNY)
4. Inspect the date information in the header
   - **Expected**: Both outbound and return dates are visible
5. Compare the header display with the sidebar display
   - **Expected**: Both show consistent round-trip information

**Result**: [ ] Pass  [ ] Fail

**Notes**: _______________

---

### Test 3: One-Way Session Regression (Maps to AC-3)

1. Locate or create a one-way flight session in the app
2. Inspect the sidebar entry for this one-way session
   - **Expected**: Shows single arrow (e.g., "KTEB -> KLAX") with one date only
3. Click into the session and check the header
   - **Expected**: Header also shows single arrow with one date
4. Verify no return date is displayed for one-way sessions
   - **Expected**: No empty date placeholder or "N/A" text

**Result**: [ ] Pass  [ ] Fail

**Notes**: _______________

---

### Test 4: Legacy Session Backward Compatibility (Maps to AC-4)

1. Identify an older chat session that was created before the round-trip fix was deployed
2. Check if this session appears in the sidebar
   - **Expected**: Session renders with a one-way arrow by default (no crash)
3. Verify no "undefined" or "null" text appears in the route or date fields
   - **Expected**: Clean display with valid text only
4. Check browser console for errors
   - **Expected**: No console errors related to missing `tripType` or `returnDate` fields

**Result**: [ ] Pass  [ ] Fail

**Notes**: _______________

---

## Test Data & Environment

### Environment Requirements

- **URL**: `http://localhost:3001` (development) or staging URL
- **Branch**: `main` (merged)
- **Setup**: `npm install && npm run dev`

### Test Data

- **Round-trip session**: CJTQML (KTEB to KVNY, Mar 2 - Mar 5, 2026)
- **One-way session**: Any existing one-way session, or create with "I need a one-way flight from KTEB to KLAX on March 15"
- **Legacy session**: Any session created before the round-trip fix (check Supabase for sessions with `trip_type = null`)

### Pre-Test Setup

1. Ensure all dependencies are installed: `npm install`
2. Start the development server: `npm run dev`
3. Verify the sidebar loads with at least one round-trip and one one-way session

---

## Sign-Off

| Tester | Role | Result | Date | Signature |
|--------|------|--------|------|-----------|
| @AB | QA Lead | [ ] Pass [ ] Fail | ____-__-__ | _________ |
| @Kham | Developer | [ ] Pass [ ] Fail | ____-__-__ | _________ |

### Final Disposition

- [ ] All tests passed -- ready for production
- [ ] Issues found -- see notes above
- [ ] Blocked -- requires {description}

---

*Generated by `/uat_instructions ONEK-200` on 2026-02-08*
