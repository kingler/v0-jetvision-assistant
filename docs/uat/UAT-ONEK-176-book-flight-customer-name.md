# UAT Instructions: ONEK-176

**Issue**: [ONEK-176](https://linear.app/designthru-ai/issue/ONEK-176) BUG: Book Flight - Customer name is not populating
**Date Generated**: 2026-02-08
**Branch**: `kinglerbercy/onek-176-bug-book-flight-customer-name-is-not-populating` (merged to `main` via PR #88)
**Status**: Done
**Priority**: High
**Author**: Generated by Claude Code `/uat_instructions`

---

## Overview

This bug fix resolves an issue where clicking "Book Flight" left the customer name field empty, preventing users from proceeding through the booking funnel. The customer name was not being populated from the proposal or the CRM, creating a hard block in the booking flow. The fix adds customer selection logic that reuses the proposal customer or allows manual selection, ensuring the customer name is reliably prefilled when the booking step begins.

---

## Acceptance Criteria

### AC-1: Customer Name Prefilled from Proposal

**Given** a user has generated a proposal for a specific customer (e.g., "John Smith")
**When** the user clicks "Book Flight" from the proposal
**Then** the customer name field is automatically populated with "John Smith" from the proposal data

### AC-2: Customer Name Populated via Selection

**Given** a user clicks "Book Flight" without a prior proposal customer
**When** the booking step begins
**Then** the user is prompted to select a customer, and upon selection, the customer name field is populated correctly

### AC-3: Booking Flow Proceeds After Name Populated

**Given** the customer name field has been populated (either from proposal or selection)
**When** the user proceeds through the booking funnel
**Then** the booking flow continues without errors, the customer name appears in the contract and any subsequent steps

### AC-4: Regression -- Proposal Flow Unaffected

**Given** the user generates a proposal (without clicking "Book Flight")
**When** the proposal flow completes
**Then** the proposal generation and email sending work identically to before this fix

---

## Test Steps

### Test 1: Customer Name from Proposal (Maps to AC-1)

1. Open a chat session with an active trip and received operator quotes
2. Generate a proposal for a specific customer (e.g., select "John Smith" from the customer selection dialog)
3. After the proposal is generated, click "Book Flight"
4. Observe the customer name field in the booking step
   - **Expected**: The customer name field shows "John Smith" (or the selected customer name) pre-populated
5. Verify the customer email is also populated if applicable
   - **Expected**: Email field shows the customer's email from the proposal

**Result**: [ ] Pass  [ ] Fail

**Notes**: _______________

---

### Test 2: Customer Selection When No Proposal Customer (Maps to AC-2)

1. Open a chat session with a trip that has quotes but no proposal generated yet
2. If a direct "Book Flight" action is available, click it
3. Observe whether a customer selection prompt appears
   - **Expected**: The user is prompted to select a customer before proceeding
4. Select a customer from the list
   - **Expected**: The customer name field is populated with the selected name
5. Verify the customer name persists through subsequent booking steps

**Result**: [ ] Pass  [ ] Fail

**Notes**: _______________

---

### Test 3: Booking Flow Continues After Population (Maps to AC-3)

1. With the customer name populated (from Test 1 or Test 2), proceed through the booking funnel
2. Verify the customer name appears in the contract or booking summary
   - **Expected**: Customer name is displayed correctly in the contract
3. Complete the booking flow (or proceed as far as possible in test environment)
   - **Expected**: No errors or blank fields related to customer name

**Result**: [ ] Pass  [ ] Fail

**Notes**: _______________

---

### Test 4: Proposal Flow Regression (Maps to AC-4)

1. Open a chat session with a trip and quotes
2. Generate a proposal and send it via email (normal proposal flow, no booking)
   - **Expected**: Proposal generates and email sends without errors
3. Verify customer name appears correctly in the email preview
   - **Expected**: No regressions in the proposal flow

**Result**: [ ] Pass  [ ] Fail

**Notes**: _______________

---

## Test Data & Environment

### Environment Requirements

- **URL**: `http://localhost:3000` (development) or staging URL
- **Branch**: `main` (commit `34ec9c0` -- `fix(booking): add customer selection and reuse proposal customer`)
- **Setup**: `npm install && npm run dev`

### Test Data

- Active trip with operator quotes
- At least one customer in the CRM database with name and email
- A generated proposal (for Test 1) to verify customer name flow

### Pre-Test Setup

1. Ensure all dependencies are installed: `npm install`
2. Ensure MCP servers are configured (Avinode, Supabase)
3. Have at least one customer record in the CRM
4. Have a trip with received quotes ready for booking

---

## Sign-Off

| Tester | Role | Result | Date | Signature |
|--------|------|--------|------|-----------|
| @AB | QA Lead | [ ] Pass [ ] Fail | ____-__-__ | _________ |
| @Kham | Developer | [ ] Pass [ ] Fail | ____-__-__ | _________ |

### Final Disposition

- [ ] All tests passed -- ready for production
- [ ] Issues found -- see notes above
- [ ] Blocked -- requires {description}

---

*Generated by `/uat_instructions ONEK-176` on 2026-02-08*
