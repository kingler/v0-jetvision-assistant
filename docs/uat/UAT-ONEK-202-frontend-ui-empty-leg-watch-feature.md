# UAT Instructions: ONEK-202

**Issue**: [ONEK-202] [Gap] No frontend UI for empty leg watch feature (ONEK-147/148)
**Date Generated**: 2026-02-08
**Branch**: `kinglerbercy/onek-202-gap-no-frontend-ui-for-empty-leg-watch-feature-onek-147148`
**Status**: In Progress
**Priority**: Medium
**Author**: Generated by Claude Code `/uat_instructions`

---

## Overview

This issue addresses a feature gap: the backend infrastructure for empty leg watches was implemented in ONEK-147/148 (database tables `empty_leg_watches` and `empty_leg_matches`, 6 MCP tools, 24 unit tests), but no frontend UI exists. This issue delivers a complete set of UI components: watch creation form, watch list/dashboard, match viewer, match interaction controls, and watch management (pause, cancel, update). These components integrate with the existing MCP tools via the chat interface or dedicated UI panels.

---

## Acceptance Criteria

### AC-1: Watch Creation Form

**Given** a user is on the chat interface or empty leg watch page
**When** the user fills out the watch creation form with departure airport, arrival airport, date range, passenger count, max price, and aircraft categories
**Then** the form calls `create_empty_leg_watch` MCP tool, creates a watch in the database, and displays a confirmation with the new watch details

### AC-2: Watch List/Dashboard

**Given** the user has created one or more empty leg watches
**When** the user navigates to the watch list or dashboard view
**Then** all active watches are displayed with route (departure/arrival), date range, match count badge, and status indicator (active/paused/expired)

### AC-3: Match Viewer

**Given** a watch has matching empty leg flights
**When** the user clicks on a watch or its match count badge
**Then** a match viewer displays all matching empty leg flights with pricing, aircraft type, operator name, departure/arrival details, and availability window

### AC-4: Match Interaction (Mark as Viewed/Interested)

**Given** the user is viewing matches for a watch
**When** the user clicks "Mark as Interested" or "Mark as Viewed" on a specific match
**Then** the `mark_match` MCP tool is called, the match status updates in the database, and the UI reflects the new state (e.g., visual indicator for "interested" matches)

### AC-5: Watch Management (Pause, Cancel, Update)

**Given** the user has an active empty leg watch
**When** the user pauses, cancels, or updates the watch criteria
**Then** the `update_empty_leg_watch` or `delete_empty_leg_watch` MCP tool is called, the database updates, and the watch list reflects the new status

### AC-6: Existing Chat and Flight Features Unaffected (Regression)

**Given** the new empty leg watch UI components are added
**When** the user performs existing workflows (flight requests, RFQ quotes, proposals, operator messaging)
**Then** all existing functionality works identically — no regressions in the chat interface, sidebar, or Avinode integration

---

## Test Steps

### Test 1: Watch Creation (Maps to AC-1)

1. Navigate to the chat interface or empty leg watch area
2. Locate the watch creation form (new component)
3. Fill in the form:
   - Departure: KTEB
   - Arrival: KLAX
   - Date range: March 15-20, 2026
   - Passengers: 4
   - Max price: $30,000
   - Aircraft category: Heavy Jet
4. Submit the form
   - **Expected**: Confirmation message appears with watch details
5. Verify the watch appears in the watch list/dashboard
   - **Expected**: New watch shows KTEB to KLAX, Mar 15-20, status "Active"

**Result**: [ ] Pass  [ ] Fail

**Notes**: _______________

---

### Test 2: Watch List/Dashboard (Maps to AC-2)

1. Ensure at least 2 watches exist (create a second watch if needed)
2. Navigate to the watch list view
   - **Expected**: Both watches displayed as cards or list items
3. Verify each watch shows: route, date range, status indicator, match count
   - **Expected**: All fields populated correctly
4. Verify the match count badge updates if new matches arrive
   - **Expected**: Badge shows correct count (e.g., "3 matches")

**Result**: [ ] Pass  [ ] Fail

**Notes**: _______________

---

### Test 3: Match Viewer (Maps to AC-3)

1. Navigate to a watch that has matches (or wait for the system to find matches)
2. Click on the watch or its match count badge
   - **Expected**: Match viewer opens showing a list of matching empty leg flights
3. Verify each match displays: aircraft type, operator name, pricing, departure/arrival airports, departure date/time
   - **Expected**: All fields populated with data from the `get_watch_matches` tool
4. Verify matches are sorted by relevance or date
   - **Expected**: Logical ordering (nearest date first or best price first)

**Result**: [ ] Pass  [ ] Fail

**Notes**: _______________

---

### Test 4: Match Interaction (Maps to AC-4)

1. Open the match viewer for a watch with matches
2. Click "Mark as Viewed" on a match
   - **Expected**: Match status updates visually (e.g., dimmed or checkmark indicator)
3. Click "Mark as Interested" on a different match
   - **Expected**: Match status updates visually (e.g., star or highlight indicator)
4. Refresh the page and return to the match viewer
   - **Expected**: Viewed/interested statuses persist (saved to database)

**Result**: [ ] Pass  [ ] Fail

**Notes**: _______________

---

### Test 5: Watch Management (Maps to AC-5)

1. From the watch list, select an active watch
2. Click "Pause" (or equivalent control)
   - **Expected**: Watch status changes to "Paused", match checking stops
3. Click "Resume" on the paused watch
   - **Expected**: Watch status returns to "Active"
4. Click "Edit" on a watch and change the date range
   - **Expected**: Watch criteria updates, confirmation shown
5. Click "Cancel" or "Delete" on a watch
   - **Expected**: Watch is removed from the active list (or marked as cancelled)
6. Confirm the deleted watch no longer appears in the dashboard
   - **Expected**: Watch is gone from the list

**Result**: [ ] Pass  [ ] Fail

**Notes**: _______________

---

### Test 6: Regression — Existing Features (Maps to AC-6)

1. Submit a new flight request via the chat
   - **Expected**: Trip created, deep link displayed, sidebar updated
2. Navigate to a session with RFQ quotes
   - **Expected**: Flight cards render with operator details and pricing
3. Generate and send a proposal
   - **Expected**: Proposal workflow (PDF, email preview, send) works correctly
4. Verify the sidebar shows all sessions correctly
   - **Expected**: No layout issues, status indicators correct

**Result**: [ ] Pass  [ ] Fail

**Notes**: _______________

---

## Test Data & Environment

### Environment Requirements

- **URL**: `http://localhost:3000`
- **Branch**: `kinglerbercy/onek-202-gap-no-frontend-ui-for-empty-leg-watch-feature-onek-147148`
- **Setup**: `npm run dev` (starts app + MCP servers)

### Test Data

- Backend MCP tools already available: `create_empty_leg_watch`, `get_empty_leg_watches`, `update_empty_leg_watch`, `delete_empty_leg_watch`, `get_watch_matches`, `mark_match`
- Database tables `empty_leg_watches` and `empty_leg_matches` from migration 027
- Create test watches using the form to generate test data

### Pre-Test Setup

1. Run database migrations to ensure `empty_leg_watches` and `empty_leg_matches` tables exist
2. Start MCP servers: `npm run dev:mcp`
3. Start the app: `npm run dev`

---

## Sign-Off

| Tester | Role | Result | Date | Signature |
|--------|------|--------|------|-----------|
| @AB | QA Lead | [ ] Pass [ ] Fail | ____-__-__ | _________ |
| @Kham | Developer | [ ] Pass [ ] Fail | ____-__-__ | _________ |

### Final Disposition

- [ ] All tests passed — ready for production
- [ ] Issues found — see notes above
- [ ] Blocked — requires {description}

---

*Generated by `/uat_instructions ONEK-202` on 2026-02-08*
