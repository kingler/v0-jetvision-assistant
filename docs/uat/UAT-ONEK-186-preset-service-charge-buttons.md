# UAT Instructions: ONEK-186

**Issue**: [ONEK-186](https://linear.app/designthru-ai/issue/ONEK-186) Add preset service charge % buttons (8%, 10%, 20%, custom) to margin selector
**Date Generated**: 2026-02-08
**Branch**: `kinglerbercy/onek-186-add-preset-service-charge-buttons-8-10-20-custom-to-margin` (merged to `main` via PR #97)
**Status**: Done
**Priority**: High
**Parent Issue**: ONEK-177
**Author**: Generated by Claude Code `/uat_instructions`

---

## Overview

This subtask of ONEK-177 replaces the previous 0-100% free-range slider in the customer selection dialog with a set of preset percentage buttons (8%, 10%, 20%) plus a "Custom" option that reveals a text input for any percentage. The default selection is 10% when the dialog first opens. This change improves usability by providing common margin values as one-click options while still allowing flexibility via the custom input.

---

## Acceptance Criteria

### AC-1: Preset Buttons Display and Selection

**Given** the customer selection dialog is opened during the proposal generation flow
**When** the user views the margin selection area
**Then** three preset buttons labeled "8%", "10%", and "20%" are displayed, along with a "Custom" option, and the "10%" button is selected by default

### AC-2: Custom Percentage Input

**Given** the customer selection dialog is open with preset buttons displayed
**When** the user clicks the "Custom" option
**Then** a text input field appears where the user can type any percentage value, and the entered value is used for the margin calculation

### AC-3: Margin Value Flows to Proposal Generation

**Given** the user has selected a margin percentage (preset or custom)
**When** the user confirms the selection and proceeds with proposal generation
**Then** the selected margin percentage is correctly applied to the proposal cost calculations (service cost = operator cost x margin%)

### AC-4: Slider Removal / Replacement (Regression)

**Given** the updated customer selection dialog is rendered
**When** the user inspects the margin selection UI
**Then** the old 0-100% free-range slider with step=5 and default=30% is no longer present, replaced entirely by the preset button group

---

## Test Steps

### Test 1: Preset Buttons and Default (Maps to AC-1)

1. Open the app and navigate to a chat session with operator quotes
2. Begin the proposal generation flow
3. When the customer selection dialog opens, locate the margin selection area
   - **Expected**: Three buttons "8%", "10%", "20%" and a "Custom" option are visible
4. Verify the default selection
   - **Expected**: "10%" is pre-selected (visually highlighted) when the dialog first opens
5. Click the "8%" button
   - **Expected**: "8%" becomes selected, "10%" is deselected
6. Click the "20%" button
   - **Expected**: "20%" becomes selected, "8%" is deselected
7. Click the "10%" button again
   - **Expected**: "10%" becomes selected

**Result**: [ ] Pass  [ ] Fail

**Notes**: _______________

---

### Test 2: Custom Percentage Input (Maps to AC-2)

1. In the customer selection dialog, click the "Custom" option
   - **Expected**: A text input field appears for entering a percentage
2. Type "12" in the custom input
   - **Expected**: The margin is set to 12%
3. Clear the input and type "5"
   - **Expected**: The margin is set to 5%
4. Click one of the preset buttons (e.g., "10%") after using custom
   - **Expected**: The custom input is dismissed and 10% is selected
5. Click "Custom" again and enter "25"
   - **Expected**: The custom input reappears and accepts 25%

**Result**: [ ] Pass  [ ] Fail

**Notes**: _______________

---

### Test 3: Margin Flows to Proposal (Maps to AC-3)

1. Select the "8%" preset and confirm the customer selection
2. Proceed to proposal generation
3. Verify the cost breakdown in the internal UI
   - **Expected**: Service cost = operator cost x 0.08, total = operator cost + service cost
4. Repeat with a custom value of "15%"
   - **Expected**: Service cost = operator cost x 0.15, total = operator cost + service cost
5. Verify the client-facing proposal
   - **Expected**: Total cost reflects the selected margin (but margin itself is not shown)

**Result**: [ ] Pass  [ ] Fail

**Notes**: _______________

---

### Test 4: Old Slider Removed (Maps to AC-4)

1. Open the customer selection dialog
2. Inspect the UI for the old-style slider component
   - **Expected**: No range slider (0-100% with step=5) is present
3. Open browser DevTools and inspect the dialog DOM
   - **Expected**: No `<input type="range">` element with the old slider configuration exists
4. Verify no reference to the old 30% default
   - **Expected**: The default is 10%, not 30%

**Result**: [ ] Pass  [ ] Fail

**Notes**: _______________

---

## Test Data & Environment

### Environment Requirements

- **URL**: `http://localhost:3000` (development) or staging URL
- **Branch**: `main` (commits `a4eac21`, `a7f1f93`)
- **Setup**: `npm install && npm run dev`

### Test Data

- Use a chat session with an active trip and received operator quotes
- Have at least one test customer in the CRM database
- Component under test: `components/customer-selection-dialog.tsx`

### Pre-Test Setup

1. Ensure all dependencies are installed: `npm install`
2. Ensure an active trip exists with at least one operator quote
3. Have a customer record available for selection

---

## Sign-Off

| Tester | Role | Result | Date | Signature |
|--------|------|--------|------|-----------|
| @AB | QA Lead | [ ] Pass [ ] Fail | ____-__-__ | _________ |
| @Kham | Developer | [ ] Pass [ ] Fail | ____-__-__ | _________ |

### Final Disposition

- [ ] All tests passed -- ready for production
- [ ] Issues found -- see notes above
- [ ] Blocked -- requires {description}

---

*Generated by `/uat_instructions ONEK-186` on 2026-02-08*
